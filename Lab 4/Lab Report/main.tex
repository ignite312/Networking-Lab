\documentclass[11pt]{article}
\usepackage{xcolor}
\usepackage{listings}
\usepackage{graphicx}
\usepackage{url}
\usepackage{multicol}
\usepackage{verbatim}
\usepackage{listings}
\usepackage{placeins}
% Define a custom color for the terminal command
\definecolor{terminalcolor}{RGB}{0, 128, 0}
\definecolor{codeBackground}{rgb}{0.1,0.1,0.1}
\definecolor{codeText}{rgb}{1, 1, 1}

% Define a custom command for highlighting terminal commands
\newcommand{\terminal}[1]{\texttt{\color{terminalcolor}#1}}
\newcommand{\labNo}{4}
\newcommand{\labTitle}{Distributed Database Management, Implementation of Iterative, and Recursive Queries of DNS Records}
% \newcommand{\date}{}

\begin{document}

\begin{titlepage}
    \begin{center}
        \includegraphics[scale=0.35]{du_logo.png}\par
        \begin{Huge}
            \textsc{University of Dhaka}\par
        \end{Huge}
        \begin{Large}
            Department of Computer Science and Engineering\par \vspace{1cm}
            CSE-3111 : Computer Networking Lab \\[12pt]    
            Lab Report \labNo : \labTitle
        \end{Large}
    \end{center}
    
    \vfill
    
    \begin{large}
        \begin{multicols}{2}
            \textbf{Submitted By :\\[12pt]}
                Name: Md. Emon Khan\\[8pt]
                Roll No : 30\\[12pt]
                Name: Mahmudul Hasan\\[8pt]
                Roll No : 60\\[12pt]
                
            \columnbreak
            
            \noindent
            \textbf{Submitted To :\\[12pt]}
                Dr. Md. Abdur Razzaque\\[12pt]
                Dr. Md. Mamun Or Rashid\\[12pt]
                Dr. Muhammad Ibrahim\\[12pt]
                Md. Redwan Ahmed Rizvee
        \end{multicols}    
    \end{large} 
    
\textbf{Submitted On :} \today\\[20pt]

\end{titlepage}

\section{Introduction}
The goal of lab-4 is to investigate the Domain Name System (DNS) through the implementation 
and analysis of the iterative and recursive resolution methods. We simulate a DNS client and
server to understand their functionalities and compare their message flow, performance, and
suitability for various scenarios. By testing and evaluating the implemented system, we aim
to gain practical insights into the inner workings of DNS and contribute to a deeper
understanding of this fundamental internet technology.
\subsection{Objectives}
Some of the preliminary objectives of this lab experiment are:
\begin{itemize}
    \item To emulate the Domain Name Service (DNS) protocol
    \item To implement and understand the functionality of an iterative DNS resolution
    \item To implement and understand the functionality of a recursive DNS resolution
    \item To understand the differences between the iterative and recursive DNS resolutions
    \item To emulate caching mechanism of DNS servers and subsequent error handling
\end{itemize}

\section{Theory}
The Domain Name System (DNS) is a hierarchical distributed system that translates
human readable domain names like "www.example.com" into machine readable IP addresses.
When a user tries to access a website, their computer follows a series of steps to resolve
the domain name to an IP address:
\begin{itemize}
    \item \textbf{Search DNS Cache:} The computer first checks its local DNS cache to see if the IP address for
    the domain name is already stored. If it is, the process is complete and the user is directed to
    the website.
    \item \textbf{Query ISP's DNS Servers:} If the IP address is not found in the cache, the computer queries its
    Internet Service Provider's (ISP) DNS servers. These servers have a larger cache of domain names and 
    IP addresses, and they may be able to resolve the query without needing to contact other servers.
    \item \textbf{Query Root Nameservers:} If the ISP's DNS servers do not have the answer, they query the
    root nameservers. The root nameservers are the top level of the DNS hierarchy, and they know the location
    of the Top-Level Domain (TLD) nameservers for all domains, e.g., .com, .org, .net etc.
    \item \textbf{Query TLD Nameservers:} The root nameservers direct the query to the TLD nameservers
    for the specific domain. These nameservers are responsible for a particular TLD, and they know the
    location of the authoritative nameservers for that domain.
    \item \textbf{Query Authoritative Nameservers:} The TLD nameservers direct the query to the authoritative
    nameservers for the specific domain. These nameservers are the ultimate source of information for the domain
    name, and they store the IP address for the domain.
    \item \textbf{Receive the Answer:} The authoritative nameservers send the IP address back to the ISP's DNS
    servers, which then cache the information and send it back to the user's computer.
    \item \textbf{Store the Answer:} The user's computer stores the IP address in its DNS cache for future reference.
\end{itemize}
This process is typically very fast, and users rarely notice the steps involved. However, it is important to understand
how DNS works, as it is a fundamental part of the internet infrastructure.

\section{Methodology}
We use Python socket UDP connection to simulate a DNS server. To manipulate and handle DNS messages in the standard DNS
message format we use the Python dnslib library
    \subsection{Setting up the DNS Server}
        \begin{itemize}
            \item We create a single server that acts as an authoritative DNS server
            \item The server awaits a client's request
            \item Upon receiving the request the server looks for the requested domain
            \item If the domain is found the server replies with the IP
            \item If the domain is not found the server replies with an error message
        \end{itemize}
    \subsection{Iterative DNS resolution}
        \begin{itemize}
            \item We create a rooted tree structure of DNS servers and have then run in different threads
            \item The client first sends a request to the root DNS server
            \item If the requested domain is found, the rooted server sends the IP and the query ends
            \item If the request is not found, the rooted server replies with a referral to a top level domain (TLD) DNS server
            \item The client then sends the request to that TLD server
            \item If the requested domain is found, the TLD server sends the reply and the query ends
            \item Else the TLD server replies with a referral to some authoritative DNS server
            \item Then the client sends the request to that authoritative DNS server
            \item The authoritative DNS server then replies with an answer if the domain is found, or else an error, anyway, ending the query
        \end{itemize}
    \subsection{Recursive DNS resolution}
        \begin{itemize}
            \item We create a rooted tree structure of DNS servers and have then run in different threads
            \item The client sends a recursive DNS query to recursive DNS resolver
            \item The recursive DNS resolver will send query to the root DNS server on behalf of the client
            \item If the root has the answer it'll send the answer to the resolver or else forward it to a TLD server
            \item If the TLD server finds the domain it'll reply with the IP to the root, otherwise forward to an authoritative DNS server
            \item If the authoritative server finds the domain it'll reply to the TLD with the IP or an error otherwise
            \item The replies will be backtracked and finally be received by the client through the resolver
        \end{itemize}
    \subsection{Extending the System}
        \begin{itemize}
            \item We try extending the system using a short TTL value
            \item Each server deletes a record when the TTL expires
            \item We implement DNS caching by saving successful query results
            \item We test the DNS server process failure
        \end{itemize}

\section{Experimental result}
    \subsection{Setting up the DNS Server}
    In the first task we are required to test a DNS server by sending request to an authoritative server. On average, the client gets the result in roughly 0.01s.
    In the example below, it took 0.0089s to retrieve a response
        \subsubsection*{Authoritative DNS Server}
        The only server here acts as the authoritative server.
            \begin{figure}[!h]
                \centering
                \includegraphics*[width=\textwidth]{task1_server.png}
                \caption{Authoritative DNS Server Status on Successful Answer}
            \end{figure}

            \begin{figure}[!h]
                \centering
                \includegraphics*[width=\textwidth]{task1_server_uns.png}
                \caption{Authoritative DNS Server Status on No Answer}
            \end{figure}
        \FloatBarrier

        \subsubsection*{Client}

            \begin{figure}[!h]
                \centering
                \includegraphics*[width=\textwidth]{task1_client.png}
                \caption{Client Status on Successful Answer}
            \end{figure}

            \begin{figure}[!h]
                \centering
                \includegraphics*[width=\textwidth]{task1_client_uns.png}
                \caption{Client Status on No Answer}
            \end{figure}
        \FloatBarrier

    \subsection{Iterative DNS resolution}
    Multiple servers are implemented for demonstrating the working method of an iterative DNS resolution. It seems, on average,
    the user gets a response in a total of 0.025s
    
        \subsubsection*{Client}
        For testing we send three requests to the DNS server
            \begin{figure}[!h]
                \centering
                \includegraphics*[width=\textwidth]{task2_client_unsuccessful.png}
                \caption{A Non-Existing Domain Name Query}
            \end{figure}
    
            \begin{figure}[!h]
                \centering
                \includegraphics*[width=\textwidth]{task2_client_back_from_root.png}
                \caption{Found in Root Server}
            \end{figure}
    
            \begin{figure}[!h]
                \centering
                \includegraphics*[width=\textwidth]{task2_client_back_from_auth.png}
                \caption{Had to Go All the Way to the Authoritative Server}
            \end{figure}
        \FloatBarrier
\newpage
            
        \subsubsection*{DNS Servers}
        Each server, upon receiving a request, either responds with a referral or an IP, depending on whether it has the domain or not.
        So the client is always making the requests iteratively
            \begin{itemize}
                \item The Root Server upon receiving the requests from the client
                
                    \begin{figure}[!h]
                        \centering
                        \includegraphics*[width=\textwidth]{task2_server_root.png}
                        \caption{Root Server Status after All Three Queries}
                    \end{figure}
                \FloatBarrier
                \item The .com TLD server during the whole query remains idle
                    
                    \begin{figure}[!h]
                        \centering
                        \includegraphics*[width=\textwidth]{task2_server_com_tld.png}
                        \caption{TLD .com Server Status after All Three Queries}
                    \end{figure}
                \FloatBarrier
                \item The .com Authoritative server during the whole process also remains idle
                    
                    \begin{figure}[!h]
                        \centering
                        \includegraphics*[width=\textwidth]{task2_server_com_auth.png}
                        \caption{The .com Authoritative Server Status after All Three Queries}
                    \end{figure}
                \FloatBarrier
                \item The .bd TLD server receives the requests from client and responses
                    
                    \begin{figure}[!h]
                        \centering
                        \includegraphics*[width=\textwidth]{task2_server_bd_tld.png}
                        \caption{The .bd TLD Server Status after All Three Queries}
                    \end{figure}
                \FloatBarrier
                \item The .bd Authoritative server also receives and responds accordingly to the client directly
                    
                    \begin{figure}[!h]
                        \centering
                        \includegraphics*[width=\textwidth]{task2_server_root.png}
                        \caption{Root Server Status after All Three Queries}
                    \end{figure}
                \FloatBarrier
            \end{itemize}

            \FloatBarrier

\newpage
    \subsection{Recursive DNS resolution}
    In this resolution, a resolver DNS server takes on the role of querying the data from the higher order servers like the root, tld or the authoritative server.
    The average time it takes in this resolution for a client to receive a final response is roughly 0.015s.
    The client always receives from the same resolver server as there's only one resolver in this scenario
        \subsubsection*{Client}
        For testing, the client sends three requests to the servers.
        \begin{figure}[!h]
            \centering
            \includegraphics*[width=\textwidth]{task3_client_unsuccessful.png}
            \caption{Client Status after Unsuccessful Query}
        \end{figure}
        \FloatBarrier
        
        \begin{figure}[!h]
            \centering
            \includegraphics*[width=\textwidth]{task3_client_back_from_tld.png}
            \caption{Client Receives Data from TLD Server through the Same Resolver Server}
        \end{figure}
        \FloatBarrier
        
        \begin{figure}[!h]
            \centering
            \includegraphics*[width=\textwidth]{task3_client_back_from_auth.png}
            \caption{Client Receives Data from Auth Server through the Same Resolver Server}
        \end{figure}
        \FloatBarrier

        \subsubsection*{DNS Servers}
        The recursive resolver DNS server now takes the role of making all the queries. Each server either sends an answer, or queries to another
        server itself and sends back the responses.
            \begin{itemize}
                \item The Recursive Resolver Server, upon receiving the requests from the client, looks in its cache, and when it doesn't find anything,
                it queries to the root server
                
                    \begin{figure}[!h]
                        \centering
                        \includegraphics*[width=\textwidth]{task3_server_resolver.png}
                        \caption{Resolver Server Status after All Three Queries}
                    \end{figure}
                \FloatBarrier
                \item The Root Server, upon receiving the requests from the client
                
                    \begin{figure}[!h]
                        \centering
                        \includegraphics*[width=\textwidth]{task3_server_root.png}
                        \caption{Root Server Status after All Three Queries}
                    \end{figure}
                \FloatBarrier
                \item The .com TLD server during the whole query
                    
                    \begin{figure}[!h]
                        \centering
                        \includegraphics*[width=\textwidth]{task3_server_com_tld.png}
                        \caption{TLD .com Server Status after All Three Queries}
                    \end{figure}
                \FloatBarrier
                \item The .com Authoritative server during the whole process
                    
                    \begin{figure}[!h]
                        \centering
                        \includegraphics*[width=\textwidth]{task3_server_com_auth.png}
                        \caption{The .com Authoritative Server Status after All Three Queries}
                    \end{figure}
                \FloatBarrier
                \item The .bd TLD server receives an unsuccessful request from the client
                    
                    \begin{figure}[!h]
                        \centering
                        \includegraphics*[width=\textwidth]{task3_server_bd_tld.png}
                        \caption{The .bd TLD Server Status after All Three Queries}
                    \end{figure}
                \FloatBarrier
                \item The .bd Authoritative server also receives an unsuccessful query which was forwarded from the TLD server
                    
                    \begin{figure}[!h]
                        \centering
                        \includegraphics*[width=\textwidth]{task3_server_bd_auth.png}
                        \caption{The .bd Authoritative Server Status after All Three Queries}
                    \end{figure}
                \FloatBarrier
            \end{itemize}
        \subsubsection*{Conclusion}
        In conclusion, we can say that the recursive DNS server resolution simplifies client-side configurations. But the increased load on the recursive
        servers may lead to slower response. The iterative DNS resolution distributes the whole load across multiple servers. But as it's constantly sending
        request back to the client, it could take longer due to latency. This is what we observe when we compare the average time taken as mentioned above.
\section{Experience}
    \begin{itemize}
        \item We had to look up how to use the dnslib package in Python
        \item We had a clearer look into the DNS message format
    \end{itemize}

\begin{thebibliography}{1}
    \bibitem{PyPi} \url{https://pypi.org/project/dnslib/}
    \bibitem{Github} \url{https://github.com/paulc/dnslib}
    \bibitem{Amazon} \url{https://aws.amazon.com/route53/what-is-dns}
    \bibitem{Constellix} \url{https://constellix.com/news/dns-record-types}
\end{thebibliography}

\end{document}
